---
meta:
  author: "Esad Cetiner"
  description: "Nextcloud Office: Sending CSS to Collabora server to render"
rule_id: 9508533
tests:
  - test_id: 1
    desc: Built-in CODE Server
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Host: example.com
            User-Agent: OWASP CRS test agent
            Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
            Content-Type: application/x-www-form-urlencoded
          port: 80
          method: POST
          uri: /settings/admin/richdocuments
          data: >-
            access_token=randomtoken&access_token_ttl=1755683041&wopi_setting_base_url=https%3A%2F%2Fexample.com%2Fapps%2Frichdocuments%2Fwopi%2Fsettings&iframe_type=admin&css_variables=
            --co-primary-text%3D%23ffffff%3B--co-settings-btn-primary-text%3D%23ffffff%3B--co-primary-element%3D%2300679e%3B--co-text-accent%3D%2300679e%3B--co-settings-btn-primary%3D%2300679e%3B
            --co-primary-light%3D%23e5eff5%3B--co-primary-element-light%3D%23e5eff5%3B--co-settings-btn-light%3D%23e5eff5%3B--co-color-error%3D%23DB0606%3B--co-color-warning%3D%23A37200%3B
            --co-color-success%3D%232d7b41%3B--co-border-radius%3D4px%3B--co-border-radius-large%3D8px%3B--co-loading-light%3D%23cccccc%3B--co-loading-dark%3D%23444444%3B
            --co-box-shadow%3Drgba%2877%2C77%2C77%2C+0.5%29%3B--co-border%3D%23ededed%3B--co-settings-border%3D%23ededed%3B--co-border-dark%3D%23dbdbdb%3B--co--settings-border
            -contrast%3D%23dbdbdb%3B--co-border-radius-pill%3D100px%3B--co-settings-btn-light-text%3D%2300293f%3B--co-settings-text%3D%23222222%3B--co-settings-text-maxcontrast%3D%236b6b6b%3B--co
            -settings-background%3D%23ffffff%3B--co-settings-background-hover%3D%23f5f5f5%3B&theme=nextcloud&ui_theme=light
          version: HTTP/1.1
        output:
          log:
            no_expect_ids:
              - 920273
              - 942430
              - 942431
              - 942432
              - 942440
              - 942460
  - test_id: 2
    desc: Dedicated Collabora Server
    stages:
      - input:
          dest_addr: 127.0.0.1
          headers:
            Host: example.com
            User-Agent: OWASP CRS test agent
            Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
            Content-Type: application/x-www-form-urlencoded
          port: 80
          method: POST
          uri: /browser/a8848448cc/admin/adminIntegratorSettings.html
          data: >-
            access_token=random&access_token_ttl=1755778321&wopi_setting_base_url=https%3A%2F%2Fexample.com%2Fapps%2Frichdocuments%2Fwopi%2Fsettings&iframe_type=admin&css_variables=
            --co-primary-text%3D%23000000%3B--co-settings-btn-primary-text%3D%23000000%3B--co-primary-element%3D%230091f2%3B
            --co-text-accent%3D%230091f2%3B--co-settings-btn-primary%3D%230091f2%3B--co-primary-light%3D%2314232c%3B--co-primary-element-light%3D%2314232c%3B
            --co-settings-btn-light%3D%2314232c%3B--co-color-error%3D%23FF3333%3B--co-color-warning%3D%23FFCC00%3B--co-color-success%3D%233B973B%3B
            --co-border-radius%3D4px%3B--co-border-radius-large%3D8px%3B--co-loading-light%3D%23777%3B--co-loading-dark%3D%23CCC%3B--co-box-shadow%3D%23000000%3B
            --co-border%3D%23292929%3B--co-settings-border%3D%23292929%3B--co-border-dark%3D%233b3b3b%3B--co--settings-border-contrast%3D%233b3b3b%3B
            --co-border-radius-pill%3D100px%3B--co-settings-btn-light-text%3D%2399d3f9%3B--co-settings-text%3D%23EBEBEB%3B--co-settings-text-maxcontrast%3D%23999999%3B
            --co-settings-background%3D%23171717%3B--co-settings-background-hover%3D%23212121%3B&theme=nextcloud&ui_theme=dark
          version: HTTP/1.1
        output:
          log:
            no_expect_ids:
              - 920273
              - 942430
              - 942431
              - 942432
              - 942440
              - 942460
